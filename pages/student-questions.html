<!DOCTYPE html>
<html>
  <head>
    <title> UQDraw </title>

    <!-- CSS -->
    <link rel="stylesheet" href="../css/main.css">
        <link rel="stylesheet" href="../css/vendor/font-awesome.min.css">

    <!-- Sets it as a mobile viewport if the user is on a mobile device -->
    <meta name="viewport" content="width=device-width,initial-scale=1">
  </head>



  <body>
    <div id="headers-top-bar">
      <img src="../assets/images/topbar-logo.png"></img>
    </div>

    <!-- Back button -->
    <button class="drawing-app-back">Back</button>

	<section class="student-question">
		<!-- Body Heading -->
		<h2 class="type-body-heading"> <span id="subject">  </span>  CODE: <span id="code">3FC</span> </h2>
		<!-- List the Questions -->
		<ul class="student-list" >
			<!-- Place PHP here, for each question in db, create a <li> element -->
          <span id="openedQuestions"></span>
			<!--<a href="drawing-app.html"><li> <span> Question Available! </span></li></a> -->
		</ul>
		</section>
		<section class="student-responses">
		<h2 class="type-body-heading"> <span> PREVIOUS RESPONSES </span> </h2>
		<!-- Place PHP here, for each question in db, create a <li> element -->
		<ul class="student-list" >
          <span id="closedQuestions"></span><!-- don't link to drawing app, since it already submitted-->
         <!-- <a ><li> <span> Draw my house </span> </li></a>-->
		</ul>
	</section>
    
  </body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

  <script type='text/javascript'>
    var courseID ="";
    var enteringCode="";
    var url="";
    $(document).ready(function() {
      if(getParameterByName("courseID")!=""){
        courseID = getParameterByName("courseID");
        url = "http://teamone.uqcloud.net/uqDrawBackend/retrieveQuestionsfromCourseId.php?courseID="+courseID;
      }
      else {
        if (getParameterByName("enteringCode") != "") {
          enteringCode = getParameterByName("enteringCode");
         url= "http://teamone.uqcloud.net/uqDrawBackend/retrieveQuestionsfromThreeDigitCode.php?enteringCode="+enteringCode;
        }
      }
      $.ajax({//retrieve JSON through ajax, if the parameter(courseID) from url is wrong, noting shows
        type: 'GET',
        url: url,
        success: function(data){
          //alert(data);
          //alert("success");
          var questionsListObject = JSON.parse(data);
          if(questionsListObject.success==1) {
            courseID = questionsListObject.subjectFull;
            document.getElementById("code").textContent = questionsListObject.enteringCode;// 3 digit code
            document.getElementById("subject").textContent = questionsListObject.subject;// course code
            var questionListHTML_open = ""; // status = 0
            var questionListHTML_close = "";//status = 1
            for (var i = 0; i < questionsListObject.questionsList.length; i++) {//generate all question from JSON
              var question = questionsListObject.questionsList[i];
              if(question.status== 0){
                questionListHTML_open += getQuestionItem(question);
              }
              if(question.status == 1){
                questionListHTML_close += getQuestionItem(question);
              }

            }
            document.getElementById("openedQuestions").innerHTML = questionListHTML_open;
            document.getElementById("closedQuestions").innerHTML = questionListHTML_close;
          }else{alert("Fail to retrieve data please signon");}
        },
        error: function(){
          alert('There was an error adding your comment');
        }
      });
    });
    function getParameterByName(name) { // get url parameter
      name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
      var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
              results = regex.exec(location.search);
      return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }
    function getQuestionItem(questionItem){ // input the question Object from JSON array, output a HTML List Item
      //"<p>Lecture</p>"+questionItem.quwstionWeek+
      return	"<a href='drawing-app.html?questionID="+questionItem.questionID+"'><li> <span> "+questionItem.title+" </span></li></a>";
    }



  </script>

</html>