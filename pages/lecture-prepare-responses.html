<html>
<head>
  <!-- CSS -->
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/vendor/gridism.css">
  <!-- Sets it as a mobile viewport if the user is on a mobile device -->
  <meta name="viewport" content="width=device-width,initial-scale=1">

	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>

<body>

	<section>
		<div class="header-l-prepare">
			<img class='images-l-subjects' src="../assets/images/topbar-logo.png" />
			<h3 class="typography-l-h3"> Prepare Mode </h3>
			<a href="lecture-responses.html"><div class="button-goto-prepare"> <p> Back </p></div></a>
		</div>
	</section>

	<section>
		<span id="responseBox"></span>
		<!-- Body Heading -->
		<!--<h2 class="type-body-heading"> Draw a House </h2>
		<!-- Body Subheading - display number of responses-->
		<!--<h3 class="type-body-response"> 9 Responses Lecture 1 - Intro</h3>
		
		<div class="grid-container">


			<!--<div class="grid-response" id="response2">
				<img class="single-response" src="..\assets\images\response-2.jpg" height="110px" width="110px" >
				<a href="..\assets\images\response-2.jpg" data-lightbox="responses" data-title="Second Response" >
					<button type="button" class="button-hidden">Expand</button>
				</a>
				<button type="button" class="button-hidden">Delete</button>
				<div id="mark1">
				</div>

			</div>

			<div class="grid-response">
				<button type="button" class="button-hidden">Expand</button>
				<button type="button" class="button-hidden">Delete</button>	
			</div>

		</div>-->

	</section>

</body>
<script src="../js/lightbox.js"></script>
<script src="../js/responses_page.js"></script>
<script type="text/babel">
	$(document).ready(function() {
		var ResultBox = React.createClass({ //props means the parameter pass from parent
				getInitialState: function() {//default data as empty
			return {subList: [], title:"",week:"", qID:"",success:"" , listLength:""};
		},
		loadCommentsFromServer: function() {//load every 2 sec
			$.ajax({
				url: this.props.url+getParameterByName("questionID"),
				dataType: 'json',
				cache: false,
				success: function(data) {
					this.setState({subList: data.submissionList,title:data.questionTitle,week:data.questionWeek,qID:data.questionID,success:data.success, listLength:data.submissionList.length});
				}.bind(this),
				error: function(xhr, status, err) {
					console.error(this.props.url, status, err.toString());
				}.bind(this)
			});
		}, componentDidMount: function() {//initial run
			this.loadCommentsFromServer();
			setInterval(this.loadCommentsFromServer, this.props.pollInterval);
		},
		render: function() {//pass data to different Items
			return (
					<div>
					<SubmissionInfo id = {this.state.id}title = {this.state.title} week={this.state.week} qID={this.state.qID} success={this.state.success} listLength={this.state.listLength}/>
	<SubmissionList subList={this.state.subList}/>

	</div>
	);
	}
	});

	var SubmissionInfo  = React.createClass({//basically it shows dynamic data of number of responses and titles
			render: function(){

		return(
				<div>

				<h2 className="type-body-heading">{this.props.title}</h2>
	<h3 className="type-body-response"> Response-{this.props.listLength} - Lecture {this.props.week}</h3>

	</div>
	);
	}
	});


	var SubmissionList = React.createClass({ //ListView contain mutiple submissions
			render: function() {
		var counter=-1;
		var submissionNodes= this.props.subList.map(function (submission) {
            counter++;
			return (
					<Submission std_id = {submission.studentID} img_link = {submission.submittedImage}id = {submission.submissionID} index={counter} date={submission.date} result={submission.result}>
	</Submission>
	);
	});
	return (
			<div className="grid-container">
			{submissionNodes}
			</div>

	);
	}
	});

	var Submission = React.createClass({//item of each record
			handleDelete:function(){
		    //deleteItem from server
		$.ajax({
			url: "../uqDrawBackend/deleteSubmission.php?submissionID="+this.props.id,
			dataType: 'json',
			cache: false,
			success: function(data) {

			}.bind(this),
			error: function(xhr, status, err) {
				console.error(this.props.url, status, err.toString());
			}.bind(this)
		});
	       },
			render: function() {
		var markID = "mark"+this.props.index;
		var imgLink = this.props.img_link+"?time="+this.props.date;
		var deleteFunction = "deleteItem("+this.props.id+")";
		var img = getCorrectIcon(parseInt(this.props.result));
		return (
				<div className="grid-response">

				<img className="single-response" src={this.props.img_link} height='110px' width='110px' ></img>
			<a href={imgLink} data-lightbox='responses' data-title={this.props.std_id} >
	<button type='button' className='button-hidden'>Expand</button></a>
	<button type="button" className="button-hidden" onClick={this.handleDelete} >Delete</button>
			<div id={markID} value={this.props.id}>
			<img   height="20px" width="20px" className="marked" src={img}></img>
			</div>
	</div>
	);
	}
	});
	var urlLink = '../uqDrawBackend/getSubmissionsFromQid.php?questionID='+getParameterByName("questionID");

	React.render( //pass data to SubmissionBox, it relresh every 2sec
	< ResultBox
	url = "../uqDrawBackend/getSubmissionsFromQid.php?questionID="
	pollInterval = {2000} / >,
			document.getElementById('responseBox')
	)
	;
	});

    function getParameterByName(name) { // get url parameter
		name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
		var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
				results = regex.exec(location.search);
		return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}
	//append correct icon in the marking div
	function getCorrectIcon(result){
		switch(result){
			case 0:
				return"../assets/images/defaultCorrect.png";
				break;
			case 1:
				return "../assets/images/correct.png";
				break;
			case 2:
				return"../assets/images/incorrect.png";
				break;
			default:
				return"";
		}

	}

	//append incorrect icon in the marking div

	function deleteItem(subID){
		alert(subID);
	}
</script>
  	</script>
</html>